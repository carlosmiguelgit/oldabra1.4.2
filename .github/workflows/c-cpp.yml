name: Build TFS 1.4.2 - Windows

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v3

      - name: Install vcpkg dependencies
        run: |
          .\vcpkg\vcpkg.exe install --triplet x64-windows ^
            boost-iostreams boost-asio boost-system boost-variant ^
            boost-lockfree boost-locale boost-beast boost-json ^
            luajit libmariadb pugixml openssl fmt zlib

      - name: Build solution in Release mode
        run: |
          "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\MSBuild.exe" vc17/themodernserver.sln /p:Configuration=Release /p:Platform=x64

      - name: Upload built executable
        uses: actions/upload-artifact@v4
        with:
          name: TFS-Windows-Release
          path: |
            vc17\x64\Release\*.exe
            vc17\x64\Release\*.dll
